# 全問題への読み解き一括追加計画（並列バックグラウンド版）

## ゴール
- 1,589問全てに読み解きを追加
- 3科目並列でバックグラウンド処理
- 自走型（メインセッションは監視のみ）

## 現状
- 読み解きフィールド: Ankiに追加済み
- 完了: 11問（経済学2025年 第1-11問）
- ガイドライン: CLAUDE.mdに記載済み

## 対象データ

| 科目 | 問題数 | ファイル数 |
|------|--------|-----------|
| economics | 175問 | 7年分 |
| finance | 175問 | 7年分 |
| it | 175問 | 7年分 |
| law | 175問 | 7年分 |
| management | 287問 | 7年分 |
| operations | 308問 | 7年分 |
| sme-policy | 294問 | 7年分 |
| **合計** | **1,589問** | **49ファイル** |

---

## 実装方針: バックグラウンド並列処理

### アーキテクチャ

```
メインセッション（監視役）
    │
    ├── Task Agent 1 (バックグラウンド): economics, finance, it
    ├── Task Agent 2 (バックグラウンド): law, management
    └── Task Agent 3 (バックグラウンド): operations, sme-policy
```

### 各Agentの動作
1. 担当科目の未処理問題を取得
2. 5問ずつ読み解きを生成
3. AnkiConnectで更新
4. 進捗をJSONに保存
5. 次の5問へ（科目完了まで繰り返し）

### コンテキスト管理
- 各Agentは独立したコンテキストを持つ
- メインセッションのコンテキストを消費しない
- Agent間の進捗共有は `yomitoki_progress.json` 経由

### 進捗管理ファイル
`yomitoki_progress.json`
```json
{
  "completed": [
    {"subject": "economics", "year": 2025, "question_number": 1},
    ...
  ],
  "stats": {"total": 11, "by_subject": {...}}
}
```

### 重複防止
- 各Agentは処理前に進捗ファイルをチェック
- 完了済みの問題はスキップ

---

## Phase 1: バッチ処理スクリプト作成

### 作成ファイル
`add_yomitoki_batch.py`

### 機能
1. scrapedフォルダから問題を読み込み
2. 進捗ファイルをチェックして未処理の問題を特定
3. 各問題に対して：
   - 問題文・解説を表示
   - 読み解きテンプレートを出力（手動でClaude Codeに入力）
4. 生成された読み解きをAnkiに追加
5. 進捗を保存

### 補助スクリプト
`update_yomitoki.py` - 単一問題の読み解きを更新するユーティリティ

---

## Phase 2: 実行フロー

### 起動コマンド
```
ユーザー: 「読み解きをバックグラウンドで開始」
    ↓
メイン: 3つのTask Agentをバックグラウンドで起動
    ↓
メイン: 「3つのAgentを起動しました。進捗確認は 'python3 add_yomitoki.py progress'」
    ↓
（Agentが自走で処理）
    ↓
ユーザー: 「進捗を確認」→ メインが進捗を表示
```

### Agent割り当て
| Agent | 担当科目 | 問題数 |
|-------|---------|--------|
| Agent 1 | economics, finance, it | 525問 |
| Agent 2 | law, management | 462問 |
| Agent 3 | operations, sme-policy | 602問 |

### 見積もり
- 3並列で処理
- 各Agent: 5問/ターン × 約100ターン = 約500問
- 全体完了: 約1〜2時間（API速度による）

---

## Phase 3: 品質管理

### ハルシネーション対策
1. Studyingの解説と矛盾しないことを確認
2. 出典を必ず記載
3. 不確かな情報は⚠️マーク

### レビュー方法
- 各科目の最初の数問を手動確認
- 問題があれば修正

---

## 検証方法

1. Ankiで読み解き付きカードをプレビュー
2. 進捗ファイルで完了状況を確認
3. 読み解きが空のカードを検索: `読み解き:`

---

## 次のアクション

### Step 1: 即時実行
1. 3つのTask Agentをバックグラウンドで起動
2. 各Agentに担当科目と処理ロジックを指示
3. 進捗監視用のコマンドを案内

### Step 2: 監視
1. `python3 add_yomitoki.py progress` で進捗確認
2. 必要に応じてAgent出力ファイルを確認
3. エラーがあれば対応

---

## 修正ファイル一覧

| ファイル | 目的 |
|---------|------|
| `add_yomitoki.py` | ユーティリティスクリプト（作成済み） |
| `yomitoki_progress.json` | 進捗管理（作成済み） |

---

## 注意事項

- 読み解きはHTML形式（`<b>`, `<br>`, `<ul><li>`）
- Studyingの解説と矛盾しないこと
- 不確かな情報は⚠️マーク
- 各Agentは独立コンテキストで動作
- 進捗ファイルで重複防止
